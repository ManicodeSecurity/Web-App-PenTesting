# Intercepting Proxy Setup

Intercepting proxies are tools used to analyze, modify, and in some cases inject traffic into the normal session created between a client and server. They are a very important tool not only for Penetration Testers but web application developers who are responsible for writing secure code. 

### Launch Burp Suite Community Edition 
Burp Suite is an integrated platform for performing security testing of web applications. Its various tools work seamlessly together to support the entire testing process, from initial mapping and analysis of an application's attack surface, through to finding and exploiting security vulnerabilities.

1. In the Kali Linux Virtual Machine, open up the Burp Suite application.  The Burp Suite application launcher can be found in the dock of the OS:
![Burp Suite Icon](../images/burp_icon.png?raw=true "Burp Icon")

2. Follow the prompts and create a new Temporary Project.
![Burp Temp](../images/burp_temp_screen.png?raw=true "Burp Temp")

3. Ensure the `Use Burp Defaults` box is checked on the next screen in the wizard and click `Start Burp`.

### Configure Firefox to use Burp as a Proxy
In order to begin using Burp as an intercepting proxy, we need to tell Firefox to route all traffic through Burp. By default, Burp Suite runs a proxy on `127.0.0.1` using port `8080`. We need to configure Firefox appropriately. 

Make sure that the Burp Suite application is running before completing the following steps.

1. Open the Firefox web browser in the Kali Linux VM
![Firefox Icon](../images/firefox_icon.png?raw=true "Firefox Icon")

2. Open the the menu in the upper-right corner of Firefox and then click `Preferences`.
![FF Prefs](../images/ff_prefs.png?raw=true "Firefox Preferences")

3. In the `General` tab, click `Settings` under the `Network Proxy` heading.

![FF Net Prefs](../images/ff_net_prefs.png?raw=true "Firefox Network Preferences")

4. Configure Firefox to use `127.0.0.1` as a Network Proxy as follows:

![FF Burp Proxy](../images/ff_burp_proxy.png?raw=true "Firefox Burp Proxy Settings")

5. Open Burp Suite and Firefox side-by-side and attempt to visit `https://manicode.us/shepherd`

You will see a certificate error that can not be bypassed due to HSTS. We will need to load Burp's certificate into Firefox as a trusted cert if we want to intercept traffic from sites which use HSTS.

![FF TLS Error](../images/TLS_err.png?raw=true "Firefox Cert Error")


6. We first need to obtain the TLS certificate from Burp Suite. Luckily, Burp has a helper URL built in that allows us to easily download the certificate. Visit `http://burp/cert` in Firefox and click `Save File`. 
    

7. Visit the `Preferences` page in Firefox and click `Privacy & Security` on the left-hand side. At the bottom under `Certificates`, click `View Certificates`.

![FF View Certs](../images/ff_view_certs.png?raw=true "Firefox View Certs")

8. On the `Certificate Manager` page, click `Import`

![FF Import Cert](../images/firefox_import_cert.png?raw=true "Firefox Import Certs")

9. You should see a file named `cacert.der`. Select it and click `Open`.

![FF Select Cert](../images/ff_select_cert.png?raw=true "Firefox Select Cert")

10. Allow Firefox to trust this cert for all purposes. Feel free to examine the certificate.

![FF Trust Cert](../images/firefox_trust.png?raw=true "Firefox Trust Cert")

11. You can now see `Portswigger CA` as an Authority in the Certificate manager.

![FF Portswigger](../images/portswigger_ca.png?raw=true "Firefox Portswigger CA")

12. Finally, Visit `https://manicode.us/shepherd` with Burp open and you should see the `Proxy` tab change colors. This means that the traffic is being intercepted. No certificate errors should occur in Firefox.

![FF Success](../images/ff_success.png?raw=true "Firefox Intercept Success")

## Bonus: OWASP ZAP Setup
OWASP ZAP is an open-source web application security intercepting proxy and scanner. It is one of the most active OWASP projects.

ZAP is very similar to Burp Suite. Go to the OWASP project page and set up Zap in the Kali Linux VM. 

Hint: ZAP comes pre-installed in the Kali VM. Use the one that is already installed.